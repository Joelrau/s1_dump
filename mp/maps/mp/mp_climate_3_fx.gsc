#include common_scripts\Utility;

main()
{	
	level._effect[ "mp_climate_center_window_toxic" ] = loadfx( "vfx/map/mp_climate/mp_climate_center_window_toxic" );
	level._effect[ "mp_climate_center_machine_window" ] = loadfx( "vfx/map/mp_climate/mp_climate_center_machine_window" );
	level._effect[ "cli_screen_drops" ] = loadfx( "vfx/map/mp_climate/cli_screen_drops" );
	level._effect[ "toxic_waterfall_splashes" ] = loadfx( "vfx/map/mp_climate/toxic_waterfall_splashes" );
	level._effect[ "mp_climate_toxic_waterfall_release" ] = loadfx( "vfx/map/mp_climate/mp_climate_toxic_waterfall_release" );
	level._effect[ "mp_climate_toxic_waterfall_large" ] = loadfx( "vfx/map/mp_climate/mp_climate_toxic_waterfall_large" );
	level._effect[ "mp_climate_vent_trans_runner" ] = loadfx( "vfx/map/mp_climate/mp_climate_vent_trans_runner" );
	level._effect[ "cli_waterfall_rainbow" ] = loadfx( "vfx/map/mp_climate/cli_waterfall_rainbow" );
	level._effect[ "mp_climate_waterfall_mesh_distort" ] = loadfx( "vfx/map/mp_climate/mp_climate_waterfall_mesh_distort" );
	level._effect[ "mp_climate_fish_school_circle" ]					 = loadfx( "vfx/map/mp_climate/mp_climate_fish_school_circle" );
	level._effect[ "mp_climate_window_toxic" ]							 = loadfx( "vfx/map/mp_climate/mp_climate_window_toxic" );
	level._effect[ "cli_lilypad_runner" ]								 = loadfx( "vfx/map/mp_climate/cli_lilypad_runner" );
	level._effect[ "cli_calm_water_foam_strip" ]						 = loadfx( "vfx/map/mp_climate/cli_calm_water_foam_strip" );
	level._effect[ "cli_calm_water_foam_sm" ]							 = loadfx( "vfx/map/mp_climate/cli_calm_water_foam_sm" );
	level._effect[ "cli_calm_water_foam" ]								 = loadfx( "vfx/map/mp_climate/cli_calm_water_foam" );
	level._effect[ "mp_climate_waterfall_large_02" ]					 = loadfx( "vfx/map/mp_climate/mp_climate_waterfall_large_02" );
	level._effect[ "mp_climate_machine_window" ]						 = loadfx( "vfx/map/mp_climate/mp_climate_machine_window" );
	level._effect[ "cli_heat_distortion_large" ]						 = loadfx( "vfx/map/mp_climate/cli_heat_distortion_large" );
	level._effect[ "cli_electrical_sparks_runner_no_bounce" ]			 = loadfx( "vfx/map/mp_climate/cli_electrical_sparks_runner_no_bounce" );
	level._effect[ "mp_climate_toxic_med_pipe" ]					     = loadfx( "vfx/map/mp_climate/mp_climate_toxic_med_pipe" );
	level._effect[ "mp_climate_toxic_sml_pipe" ]						 = loadfx( "vfx/map/mp_climate/mp_climate_toxic_sml_pipe" );
	level._effect[ "mp_climate_toxic_lrg_pipe" ] 						 = loadfx( "vfx/map/mp_climate/mp_climate_toxic_lrg_pipe" );
	level._effect[ "mp_climate_lrg_pipe" ] 								 = loadfx( "vfx/map/mp_climate/mp_climate_lrg_pipe" );
	level._effect[ "mp_climate_med_pipe" ] 								 = loadfx( "vfx/map/mp_climate/mp_climate_med_pipe" );
	level._effect[ "mp_climate_sml_pipe" ] 							     = loadfx( "vfx/map/mp_climate/mp_climate_sml_pipe" );
	level._effect[ "mp_climate_vent_filler" ] 							 = loadfx( "vfx/map/mp_climate/mp_climate_vent_filler" );
	level._effect[ "cli_small_toxic_steam" ] 							 = loadfx( "vfx/map/mp_climate/cli_small_toxic_steam" );
	level._effect[ "cli_slow_steam_linger" ] 							 = loadfx( "vfx/map/mp_climate/cli_slow_steam_linger" );
	level._effect[ "cli_lightrays_sml" ] 								 = loadfx( "vfx/map/mp_climate/cli_lightrays_sml" );
	level._effect[ "cli_clear_water_displacement_patch" ] 				 = loadfx( "vfx/map/mp_climate/cli_clear_water_displacement_patch" );
	level._effect[ "cli_toxic_water_displacement_patch" ]				 = loadfx( "vfx/map/mp_climate/cli_toxic_water_displacement_patch" );
	level._effect[ "cli_electrical_arc_roll" ] 						 	 = loadfx( "vfx/map/mp_climate/cli_electrical_arc_roll" );
	level._effect[ "mp_climate_green_room_ambient" ] 					 = loadfx( "vfx/map/mp_climate/mp_climate_green_room_ambient" );
	level._effect[ "cli_butterfly_runner" ] 							 = loadfx( "vfx/map/mp_climate/cli_butterfly_runner" );
	level._effect[ "cli_toxic_water_displacement_patch" ] 				 = loadfx( "vfx/map/mp_climate/cli_toxic_water_displacement_patch" );
	level._effect[ "cli_lightrays_lrg" ]								 = loadfx( "vfx/map/mp_climate/cli_lightrays_lrg" );
	level._effect[ "cli_toxic_water_boiling_clear_runner" ] 			 = loadfx( "vfx/map/mp_climate/cli_toxic_water_boiling_clear_runner" );
	level._effect[ "cli_smoke_rise" ] 									 = loadfx( "vfx/map/mp_climate/cli_smoke_rise" );
	level._effect[ "mp_climate_vent_smoke_transition_b" ] 				 = loadfx( "vfx/map/mp_climate/mp_climate_vent_smoke_transition_b" );
	level._effect[ "cli_insect_dragonfly_runner" ] 						 = loadfx( "vfx/map/mp_climate/cli_insect_dragonfly_runner" );
	level._effect[ "mp_godray_dusty" ] 									 = loadfx( "vfx/map/mp_climate/mp_godray_dusty" );
	level._effect[ "falling_water_drip_line_runner_fast" ] 				 = loadfx( "vfx/water/falling_water_drip_line_runner_fast" );
	level._effect[ "cli_vent_fire_crawl" ] 								 = loadfx( "vfx/map/mp_climate/cli_vent_fire_crawl" );
	level._effect[ "cli_lilypad" ] 										 = loadfx( "vfx/map/mp_climate/cli_lilypad" );
	level._effect[ "cli_lilypad_death" ] 								 = loadfx( "vfx/map/mp_climate/cli_lilypad_death" );
	level._effect[ "mp_climate_vent_transition" ] 					     = loadfx( "vfx/map/mp_climate/mp_climate_vent_transition" );
	level._effect[ "cli_toxic_water_transition_pool_2" ] 				 = loadfx( "vfx/map/mp_climate/cli_toxic_water_transition_pool_2" );
	level._effect[ "cli_toxic_water_transition_pool_1" ]				 = loadfx( "vfx/map/mp_climate/cli_toxic_water_transition_pool_1" );
	level._effect[ "mp_climate_electrical_sparks_heavy" ] 				 = loadfx( "vfx/map/mp_climate/mp_climate_electrical_sparks_heavy" );
	level._effect[ "cli_less_freq_electrical_sparks_runner" ] 			 = loadfx( "vfx/map/mp_climate/cli_less_freq_electrical_sparks_runner" );
	level._effect[ "cli_electrical_sparks_runner" ] 					 = loadfx( "vfx/map/mp_climate/cli_electrical_sparks_runner" );
	level._effect[ "mp_climate_vent_smoke_transition" ] 			     = loadfx( "vfx/map/mp_climate/mp_climate_vent_smoke_transition" );
	level._effect[ "mp_climate_electrical_arcs_runner" ] 			     = loadfx( "vfx/map/mp_climate/mp_climate_electrical_arcs_runner" );
	level._effect[ "mp_climate_smoke_plume" ] 							 = loadfx( "vfx/map/mp_climate/mp_climate_smoke_plume" );
	level._effect[ "mp_climate_steam_toxic_transition" ] 				 = loadfx( "vfx/map/mp_climate/mp_climate_steam_toxic_transition" );
	level._effect[ "mp_climate_vent_steam_small" ] 						 = loadfx( "vfx/map/mp_climate/mp_climate_vent_steam_small" );
	level._effect[ "mp_climate_ambient_int" ] 							 = loadfx( "vfx/map/mp_climate/mp_climate_ambient_int" );
	level._effect[ "mp_climate_dust_ambient_int" ] 						 = loadfx( "vfx/map/mp_climate/mp_climate_dust_ambient_int" );
	level._effect[ "water_pipe_drip_lp" ] 								 = loadfx( "vfx/water/water_pipe_drip_lp" );
	level._effect[ "electrical_sparks_small_runner" ] 					 = loadfx( "vfx/explosion/electrical_sparks_small_runner" );
	level._effect[ "mp_climate_fish_jumping_runner" ]     			     = loadfx( "vfx/map/mp_climate/mp_climate_fish_jumping_runner" );
	level._effect[ "mp_climate_fish_jumping" ] 							 = loadfx( "vfx/map/mp_climate/mp_climate_fish_jumping" );
	level._effect[ "mp_climate_vent_steam" ] 							 = loadfx( "vfx/map/mp_climate/mp_climate_vent_steam" );
	level._effect[ "mp_climate_leaves_blow_runner" ] 					 = loadfx( "vfx/map/mp_climate/mp_climate_leaves_blow_runner" );
	level._effect[ "mp_climate_birds_takeoff_runner" ] 					 = loadfx( "vfx/map/mp_climate/mp_climate_birds_takeoff_runner" );
	level._effect[ "mp_climate_crumbling_rock_runner" ] 				 = loadfx( "vfx/map/mp_climate/mp_climate_crumbling_rock_runner" );
	level._effect[ "mp_climate_cloud_cover" ] 							 = loadfx( "vfx/map/mp_climate/mp_climate_cloud_cover" );
	level._effect[ "cli_toxic_water_boiling_bubble_runner" ] 			 = loadfx( "vfx/map/mp_climate/cli_toxic_water_boiling_bubble_runner" );
	level._effect[ "cli_water_surface_steam" ] 							 = loadfx( "vfx/map/mp_climate/cli_water_surface_steam" );
	level._effect[ "test_effect" ]										 = loadfx( "vfx/test/test_fx" );
	level._effect[ "fx_sunflare_mp_climate_3" ]							 = loadfx( "vfx/lensflare/fx_sunflare_mp_climate_3" );
	level._effect[ "mp_climate_waterfall_large" ] 						 = loadfx( "vfx/map/mp_climate/mp_climate_waterfall_large" );
	level._effect[ "flower_petals_runner" ] 						     = loadfx( "vfx/map/mp_climate/flower_petals_runner" );
	level._effect[ "ambient_needles_runner" ] 							 = loadfx( "vfx/map/mp_climate/ambient_needles_runner" );
	level._effect[ "mp_climate_fish_school" ] 							 = loadfx( "vfx/map/mp_climate/mp_climate_fish_school" );
	level._effect[ "waterfall_splashes" ] 						         = loadfx( "vfx/map/mp_climate/waterfall_splashes" );
	level._effect[ "mp_climate_waterfall_release" ] 					 = loadfx( "vfx/map/mp_climate/mp_climate_waterfall_release" );
	level._effect[ "plastic_shreds_hanging_e_slow" ] 					 = loadfx( "vfx/wind/plastic_shreds_hanging_e_slow" );
	level._effect[ "mp_climate_streaming_water" ] 						 = loadfx( "vfx/map/mp_climate/mp_climate_streaming_water" );
	level._effect[ "mp_ground_grassdirt_runner" ] 					     = loadfx( "vfx/map/mp_climate/mp_ground_grassdirt_runner" );
	
	
		
/#
    if ( getdvar( "clientSideEffects" ) != "1" )
        maps\createfx\mp_climate_3_fx::main();
#/    
    //thread lilypad_fx_old();
    //thread lilypad_fx();
    
    level thread onPlayerConnect();
}

onPlayerConnect()
{
	while( true )
	{
		level waittill( "connected", player );
		start_persistent_fx( player );
	}
}

start_persistent_fx( player ) // self == player
{
	if( level.toxicEventComplete )
		toxic_fx( player );
	else if( level.toxicEventStarted )
		mid_event_fx( player );
	else
		clean_fx( player );
}

// Play all persistent fx during the clean phase (before event)
clean_fx( player )
{
	vent_steam_fx( player ); //6 //Gas spewing from machine
	waterfall_start( player ); //20 //Waterfall particle effects
	machine_window_fx( player ); //17 //Windows turn Blue
	clean_water_foam_fx( player ); //203 //Green algae on water
	fish_school_fx( player ); //2 //Fish
}

// Play all persistent fx during the toxic phase (after event)
// Note: Expects the entire event to be over
toxic_fx( player )
{
	top_vent_damage_fx( player ); //7 Explosion + Smoke straight up the top
	clear_water_transition_looping_fx( player ); //202 //Toxic Waves
	toxic_vent_steam_fx( player ); //5 //Main machine spewing yellow gas
	small_toxic_vent_steam_fx( player ); //16 //Very small vents on machine spewing yellow gas
	machine_toxic_window_fx( player ); //19 //Windows turn Yellow
	vent_firecrawl_fx( player ); //14 //Main fire in machine
	machine_toxic_pipes_fx( player ); //18 //Pipes turn Yellow
	dead_fish_fx( player ); //3 //Dead Fish Flopping
	toxic_waterfall_start( player ); //21 //Waterfalls turn Yellow
	vent_smoke_damage_fx( player ); //8 //Fire and Flames from machine
	less_freq_electrical_sparks_fx( player ); //11 //Fireworks from machine
	water_surface_steam_fx( player ); //1 //Toxic Steam from water
}

// If joining the game during the middle of the event, manage which persistent fx have already fired
mid_event_fx( player )
{	
	//Start up the persistent VFX that haven't been stopped yet
	if( !IsDefined( level.toxicStage6Finished ) )
	{
		fish_school_fx( player ); //2 //Fish
		waterfall_start( player ); //20 //Waterfall particle effects
	
		if( !IsDefined( level.toxicStage5Finished ) )
		{
			clean_water_foam_fx( player ); //203 //Green algae on water
			machine_window_fx( player ); //17 //Windows turn Blue
			
			if( !IsDefined( level.toxicStage3Finished ) )
			{
				vent_steam_fx( player ); //6 //Gas spewing from machine
			}
		}
	}
	
	//Start up the persistent effects that have already been played during the map event
	if( IsDefined( level.toxicStage1Finished ) && level.toxicStage1Finished )
	{
		top_vent_damage_fx( player ); //7 Explosion + Smoke straight up the top
	
		if( IsDefined( level.toxicStage2Finished ) && level.toxicStage2Finished )
		{
			clear_water_transition_looping_fx( player ); //202 //Toxic Waves
			electrical_arcs_fx( player ); //12 //Lightning Bolts and Sparks
			
			if( IsDefined( level.toxicStage3Finished ) && level.toxicStage3Finished )
			{
				toxic_vent_steam_fx( player ); //5 //Main machine spewing yellow gas
				small_toxic_vent_steam_fx( player ); //16 //Very small vents on machine spewing yellow gas
				machine_toxic_window_fx( player ); //19 //Windows turn Yellow
				
				if( IsDefined( level.toxicStage4Finished ) && level.toxicStage4Finished )
				{
					vent_firecrawl_fx( player ); //14 //Main fire in machine
					
					if( IsDefined( level.toxicStage5Finished ) && level.toxicStage5Finished )
					{
						machine_toxic_pipes_fx( player ); //18 //Pipes turn Yellow
						
						if( IsDefined( level.toxicStage6Finished ) && level.toxicStage6Finished )
						{
							dead_fish_fx( player ); //3 //Dead Fish Flopping
							toxic_waterfall_start( player ); //21 //Waterfalls turn Yellow
							
							if( IsDefined( level.toxicStage7Finished ) && level.toxicStage7Finished )
							{
								vent_smoke_damage_fx( player ); //8 //Fire and Flames from machine
							}
						}
					}
				}
			}
		}
	}
}

//steam vfx on the surface of the water
water_surface_steam_fx( player )
{
	level thread common_scripts\_exploder::activate_clientside_exploder(1, player);
}

waterfall_start( player )
{
	level thread common_scripts\_exploder::activate_clientside_exploder(20, player);
}

toxic_waterfall_start( player )
{
	if( !IsDefined( player ) )
	{
		StopClientExploder(20);
	}
	level thread common_scripts\_exploder::activate_clientside_exploder(21, player);
}

dead_fish_fx( player )
{
	if( !IsDefined( player ) )
	{
		StopClientExploder(2);
		wait 1;
	}
	level thread common_scripts\_exploder::activate_clientside_exploder(3, player);
}

machine_window_fx( player )
{
	level thread common_scripts\_exploder::activate_clientside_exploder(17, player);
}

machine_toxic_pipes_fx( player )
{
	if( !IsDefined( player ) )
	{
		StopClientExploder(17);
	}
	level thread common_scripts\_exploder::activate_clientside_exploder(18, player);
}

machine_toxic_window_fx( player )
{
	level thread common_scripts\_exploder::activate_clientside_exploder(19, player);
}

fish_school_fx( player )
{
	level thread common_scripts\_exploder::activate_clientside_exploder(2, player);
}

water_transition_fx()//colored pools to mask water swap
{
	level thread common_scripts\_exploder::activate_clientside_exploder(200);
	wait (8);
	StopClientExploder(201);
	waitframe;
	StopClientExploder(203);
}

clear_water_transition_fx()//boiling bubbles at start of transition
{
	level thread common_scripts\_exploder::activate_clientside_exploder(201);
}

clear_water_transition_looping_fx( player )
{
	if( !IsDefined( player ) )
	{
		waitframe;
	}
	level thread common_scripts\_exploder::activate_clientside_exploder(202, player);
}

//////////climate machine dynamic event transitional effects//////////////////
vent_steam_fx( player )
{
	level thread common_scripts\_exploder::activate_clientside_exploder(6, player);
}

toxic_vent_steam_fx( player )
{
	if( !IsDefined( player ) )
	{
		StopClientExploder(6);
	}
	level thread common_scripts\_exploder::activate_clientside_exploder(5, player);
}

small_toxic_vent_steam_fx( player )
{
	level thread common_scripts\_exploder::activate_clientside_exploder(16, player);
}

top_vent_damage_fx( player )
{
	level thread common_scripts\_exploder::activate_clientside_exploder(7, player);
}

vent_smoke_damage_fx( player )
{
	level thread common_scripts\_exploder::activate_clientside_exploder(8, player);
}

vent_metal_shards_fx()
{
	level thread common_scripts\_exploder::activate_clientside_exploder(9);	
}

freq_electrical_sparks_fx()
{
	level thread common_scripts\_exploder::activate_clientside_exploder(10);	
}

less_freq_electrical_sparks_fx( player )
{
	if( !IsDefined( player ) )
	{
		StopClientExploder(10);
		StopClientExploder(12);
		StopClientExploder(13);
	}
	level thread common_scripts\_exploder::activate_clientside_exploder(11, player);	
}

electrical_arcs_fx( player )
{
	level thread common_scripts\_exploder::activate_clientside_exploder(12, player);	
}

electrical_arc_coils_fx()
{
	level thread common_scripts\_exploder::activate_clientside_exploder(15);	
}

heavy_electrical_sparks_fx()
{
	level thread common_scripts\_exploder::activate_clientside_exploder(13);	
}

vent_firecrawl_fx( player )
{
	level thread common_scripts\_exploder::activate_clientside_exploder(14, player);	
}

clean_water_foam_fx( player )
{
	level thread common_scripts\_exploder::activate_clientside_exploder(203, player);
}

//lily pad vfx
//lilypad_fx()
//{
//	wait (13);
//	level thread common_scripts\_exploder::activate_clientside_exploder(204);
//}
//
//lilypad_death_fx()
//{
//	waitframe;
//	level thread common_scripts\_exploder::activate_clientside_exploder(205);
//	wait (1.5);
//	StopClientExploder(204);
//}
		
//lilypad_fx_old()
//{
//	wait (15);
//	lilypad_alive = getstructarray( "fx_lilypad_loc", "targetname" );
//	
//	foreach (lilypad in lilypad_alive)
//		{
//			PlayFX (getfx ("cli_lilypad"), lilypad.origin);
//		}
//}

/////////////////////////////////////////////////////////////////


